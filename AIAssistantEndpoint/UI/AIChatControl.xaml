<UserControl
    x:Class="AIAssistantEndpoint.UI.AIChatControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:AIAssistantEndpoint.UI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="600"
    d:DesignWidth="400"
    Background="#F5F5F5"
    mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="*" />
            <RowDefinition />
            <RowDefinition Height="40" />
        </Grid.RowDefinitions>

        <!--  Заголовок  -->
        <Grid
            Grid.Row="0"
            Margin="0"
            Background="#2196F3">
            <StackPanel
                Margin="10,0"
                VerticalAlignment="Center"
                Orientation="Horizontal">
                <TextBlock
                    VerticalAlignment="Center"
                    FontSize="14"
                    FontWeight="Bold"
                    Foreground="White"
                    Text="🤖 AI Assistant" />
                <Button
                    x:Name="SettingsButton"
                    Width="30"
                    Height="30"
                    Background="Transparent"
                    BorderThickness="0"
                    Click="SettingsButton_Click"
                    Content="⚙️"
                    Foreground="White"
                    ToolTip="Открыть настройки" />
                <Button
                    x:Name="ClearButton"
                    Width="30"
                    Height="30"
                    Background="Transparent"
                    BorderThickness="0"
                    Click="ClearButton_Click"
                    Content="🗑️"
                    Foreground="White"
                    ToolTip="Очистить чат" />
            </StackPanel>
        </Grid>

        <!--  Сообщения  -->
        <ListBox
            x:Name="MessagesListBox"
            Grid.Row="1"
            Margin="0"
            Background="#FAFAFA"
            BorderThickness="0"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border
                        Margin="10,5"
                        Padding="10"
                        Background="White"
                        BorderBrush="#EEEEEE"
                        BorderThickness="1"
                        CornerRadius="5">
                        <StackPanel>
                            <TextBlock
                                FontSize="11"
                                FontWeight="Bold"
                                Foreground="{Binding SenderColor}"
                                Text="{Binding SenderName}" />
                            <TextBlock
                                Margin="0,5,0,0"
                                Foreground="#333333"
                                Text="{Binding Text}"
                                TextWrapping="Wrap" />
                            <TextBlock
                                Margin="0,5,0,0"
                                FontSize="10"
                                Foreground="#999999"
                                Text="{Binding Timestamp, StringFormat='HH:mm:ss'}" />
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="BorderThickness" Value="0" />
                    <Setter Property="Padding" Value="0" />
                    <Setter Property="Margin" Value="0" />
                </Style>
            </ListBox.ItemContainerStyle>
        </ListBox>

        <!--  Ввод и вложения  -->
        <Grid
            Grid.Row="2"
            Margin="0"
            Background="White">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="160" />
            </Grid.ColumnDefinitions>

            <StackPanel
                Grid.Column="0"
                Margin="10"
                VerticalAlignment="Stretch">
                <TextBlock
                    Margin="0,0,0,5"
                    FontWeight="Bold"
                    Foreground="#333333"
                    Text="Вложения:" />
                <ListBox
                    x:Name="AttachmentsListBox"
                    Height="60"
                    Margin="0,0,0,10"
                    Background="#F9F9F9"
                    BorderBrush="#DDDDDD"
                    BorderThickness="1">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <DockPanel>
                                <TextBlock
                                    VerticalAlignment="Center"
                                    Text="{Binding}"
                                    TextTrimming="CharacterEllipsis" />
                                <Button
                                    Margin="8,0,0,0"
                                    Click="RemoveAttachment_Click"
                                    Content="Удалить"
                                    DockPanel.Dock="Right"
                                    Tag="{Binding}" />
                            </DockPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <TextBox
                    x:Name="InputTextBox"
                    Margin="0"
                    Padding="10"
                    VerticalAlignment="Stretch"
                    AcceptsReturn="True"
                    Background="#F5F5F5"
                    BorderBrush="#CCCCCC"
                    BorderThickness="1"
                    Foreground="#333333"
                    KeyDown="InputTextBox_KeyDown"
                    TextWrapping="Wrap"
                    VerticalScrollBarVisibility="Auto" />
            </StackPanel>

            <StackPanel
                Grid.Column="1"
                Margin="0,10,10,10"
                VerticalAlignment="Top"
                Orientation="Vertical">
                <Button
                    x:Name="InsertSelectionButton"
                    Height="30"
                    Margin="0,0,0,6"
                    Background="#607D8B"
                    Click="InsertSelection_Click"
                    Content="Вставить выделение"
                    Foreground="White" />
                <Button
                    x:Name="InsertDocumentButton"
                    Height="30"
                    Margin="0,0,0,6"
                    Background="#607D8B"
                    Click="InsertDocument_Click"
                    Content="Вставить документ"
                    Foreground="White" />
                <Button
                    x:Name="CompleteCodeButton"
                    Height="30"
                    Margin="0,0,0,6"
                    Background="#3F51B5"
                    Click="CompleteCode_Click"
                    Content="Complete Code"
                    Foreground="White" />
                <Button
                    x:Name="InsertSelectionAsFileButton"
                    Height="30"
                    Margin="0,0,0,6"
                    Background="#455A64"
                    Click="InsertSelectionAsFile_Click"
                    Content="Вставить выделение как файл"
                    Foreground="White" />
                <Button
                    x:Name="AttachButton"
                    Height="30"
                    Margin="0,0,0,6"
                    Background="#607D8B"
                    Click="AttachButton_Click"
                    Content="Прикрепить"
                    Foreground="White" />
                <Button
                    x:Name="SendButton"
                    Height="35"
                    Background="#4CAF50"
                    Click="SendButton_Click"
                    Content="Отправить (Ctrl+Enter)"
                    FontWeight="Bold"
                    Foreground="White"
                    IsEnabled="False" />
            </StackPanel>
        </Grid>

        <!--  Статус  -->
        <StatusBar
            Grid.Row="3"
            Padding="10,0"
            Background="#F5F5F5">
            <TextBlock
                x:Name="StatusTextBlock"
                VerticalAlignment="Center"
                Foreground="#666666"
                Text="Подключение..." />
        </StatusBar>
    </Grid>
</UserControl>
